<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel de TVs - Salvar no GitHub</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; color: #333; }
    label, textarea, input, select, button { display: block; margin-bottom: 10px; width: 100%; }
    button { padding: 10px; background-color: #007acc; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #005fa3; }
    pre { background: #eee; padding: 10px; }
  </style>
</head>
<body>
  <h1>Painel de TVs - Salvar Configuração no GitHub</h1>

  <label for="tv">Nome da TV (ex: tv01):</label>
  <select id="tv">
    <option value="tv01">tv01</option>
    <option value="tv02">tv02</option>
    <option value="tv03">tv03</option>
  </select>

  <label for="config">Conteúdo JSON:</label>
  <textarea id="config" rows="10">{
  "configuracoes": {
    "segundosEntrePaginas": 30,
    "segundosConteudoExtra": 20,
    "timeoutMaximoVideo": 30,
    "tempoTransicao": 800,
    "abasPowerBI": ["ACC Online", "Resumo Mensal"]
  },
  "conteudo": []
}</textarea>

  <label for="token">Cole aqui seu GitHub Token Pessoal:</label>
  <input type="password" id="token" placeholder="ghp_xxxxxxxxxxxxxxxxxxxxx" />

  <button onclick="salvarNoGitHub()">Salvar no GitHub</button>

  <pre id="status"></pre>

  <script>
    async function salvarNoGitHub() {
      const token = document.getElementById("token").value.trim();
      const tv = document.getElementById("tv").value.trim();
      const conteudo = document.getElementById("config").value;
      const status = document.getElementById("status");

      if (!token) {
        alert("Por favor, cole seu GitHub Token pessoal.");
        return;
      }

      const base64Content = btoa(unescape(encodeURIComponent(conteudo)));
      const repo = "TvFood";
      const user = "Drazixor";
      const path = `configs/${tv}.json`;
      const urlGet = `https://api.github.com/repos/${user}/${repo}/contents/${path}`;

      status.textContent = "Verificando arquivo existente...";

      let sha = null;
      try {
        const resGet = await fetch(urlGet, {
          headers: { Authorization: `token ${token}` }
        });
        if (resGet.ok) {
          const data = await resGet.json();
          sha = data.sha;
        }
      } catch (e) {
        console.warn("Arquivo novo, não encontrado.");
      }

      status.textContent = "Enviando arquivo para o GitHub...";

      const res = await fetch(urlGet, {
        method: "PUT",
        headers: {
          Authorization: `token ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: `Atualizando config ${tv}`,
          content: base64Content,
          sha: sha || undefined
        })
      });

      if (res.ok) {
        status.textContent = `✅ Configuração salva com sucesso em ${path}`;
      } else {
        const err = await res.json();
        status.textContent = `❌ Erro ao salvar: ${err.message}`;
      }
    }
  </script>
</body>
</html>

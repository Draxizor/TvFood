<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel de TVs - Divis√£o Food</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; color: #333; }
    h1, h2 { margin-bottom: 10px; }
    label { margin-top: 10px; display: block; font-weight: bold; }
    input[type="text"], input[type="number"], input[type="date"], select, textarea {
      width: 100%; padding: 8px; margin: 5px 0 15px 0; box-sizing: border-box;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
    tr:nth-child(even) { background: #f9f9f9; }
    .controls { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px; }
    .controls > div { flex: 1; min-width: 180px; }
    .btn { padding: 10px 15px; background: #007acc; color: #fff; border: none; cursor: pointer; margin-top: 10px; }
    .btn:hover { background: #005a99; }
    .small { font-size: 12px; color: #666; }
    #saida { white-space: pre-wrap; background: #fff; padding: 10px; margin-top: 20px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>Painel de TVs - Divis√£o Food</h1>

  <div class="controls">
    <div>
      <label for="tv">Selecionar TV:</label>
      <select id="tv">
        <option value="tv01">tv01</option>
        <option value="tv02">tv02</option>
        <option value="tv03">tv03</option>
      </select>
      <button class="btn" id="btnCarregar">üîÑ Carregar</button>
    </div>
    <div>
      <label for="segundosEntrePaginas">Tempo entre abas (s):</label>
      <input type="number" id="segundosEntrePaginas" value="30" />
    </div>
    <div>
      <label for="segundosConteudoExtra">Tempo conte√∫do extra (s):</label>
      <input type="number" id="segundosConteudoExtra" value="20" />
    </div>
    <div>
      <label for="timeoutMaximoVideo">M√°ximo v√≠deo (s):</label>
      <input type="number" id="timeoutMaximoVideo" value="30" />
    </div>
    <div>
      <label for="tempoTransicao">Tempo de transi√ß√£o (ms):</label>
      <input type="number" id="tempoTransicao" value="800" />
    </div>
  </div>

  <label for="abas">Abas do Power BI (separadas por v√≠rgula):</label>
  <textarea id="abas" rows="2">ACC Online,Resumo Mensal,GDD Di√°rio</textarea>

  <h2>Conte√∫dos Extras</h2>
  <table id="conteudoTable">
    <thead>
      <tr>
        <th>Tipo</th>
        <th>URL/Cidade</th>
        <th>Exibir</th>
        <th>De</th>
        <th>At√©</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody id="conteudoBody"></tbody>
  </table>
  <button class="btn" id="btnAdicionar">+ Adicionar Conte√∫do</button>
  <button class="btn" id="btnSalvar">üíæ Salvar Configura√ß√£o</button>

  <pre id="saida"></pre>

  <script>
    const tipos = ["powerbi", "imagem", "video", "clima"];
    const tabela = document.getElementById("conteudoBody");

    function adicionarConteudo(c = {}) {
      const linha = document.createElement("tr");
      linha.innerHTML = `
        <td>
          <select>
            ${tipos.map(t => `<option value="${t}" ${c.tipo === t ? 'selected' : ''}>${t}</option>`).join("")}
          </select>
        </td>
        <td><input type="text" value="${c.url || c.cidade || ''}" /></td>
        <td>
          <select onchange="this.parentNode.parentNode.querySelectorAll('input[type=date]').forEach(i => i.style.display = this.value === 'intervalo' ? 'inline' : 'none')">
            <option value="sempre" ${c.exibicao === "intervalo" ? "" : "selected"}>Sempre</option>
            <option value="intervalo" ${c.exibicao === "intervalo" ? "selected" : ""}>Entre datas</option>
          </select>
        </td>
        <td><input type="date" value="${c.dataInicio || ''}" style="display: ${c.exibicao === 'intervalo' ? 'inline' : 'none'}" /></td>
        <td><input type="date" value="${c.dataFim || ''}" style="display: ${c.exibicao === 'intervalo' ? 'inline' : 'none'}" /></td>
        <td><button onclick="this.parentNode.parentNode.remove()">Remover</button></td>
      `;
      tabela.appendChild(linha);
    }

    async function carregarConfig() {
      const tv = document.getElementById("tv").value;
      const url = `https://draxizor.github.io/TvFood/${tv}.json`;
      try {
        const resp = await fetch(url);
        if (!resp.ok) throw new Error("Erro ao buscar JSON");
        const json = await resp.json();

        document.getElementById("segundosEntrePaginas").value = json.configuracoes.segundosEntrePaginas;
        document.getElementById("segundosConteudoExtra").value = json.configuracoes.segundosConteudoExtra;
        document.getElementById("timeoutMaximoVideo").value = json.configuracoes.timeoutMaximoVideo;
        document.getElementById("tempoTransicao").value = json.configuracoes.tempoTransicao;
        document.getElementById("abas").value = json.configuracoes.abasPowerBI.join(", ");

        tabela.innerHTML = "";
        json.conteudo.forEach(c => adicionarConteudo(c));
        document.getElementById("saida").textContent = `Configura√ß√£o carregada para ${tv}`;
      } catch (e) {
        document.getElementById("saida").textContent = `‚ùå Erro ao carregar JSON para ${tv}`;
      }
    }

    function salvar() {
      const config = {
        configuracoes: {
          segundosEntrePaginas: +document.getElementById("segundosEntrePaginas").value,
          segundosConteudoExtra: +document.getElementById("segundosConteudoExtra").value,
          timeoutMaximoVideo: +document.getElementById("timeoutMaximoVideo").value,
          tempoTransicao: +document.getElementById("tempoTransicao").value,
          abasPowerBI: document.getElementById("abas").value.split(',').map(s => s.trim()).filter(s => s)
        },
        conteudo: []
      };

      [...tabela.querySelectorAll("tr")].forEach(tr => {
        const tipo = tr.children[0].querySelector("select").value;
        const valor = tr.children[1].querySelector("input").value;
        const exibicao = tr.children[2].querySelector("select").value;
        const dataInicio = tr.children[3].querySelector("input").value;
        const dataFim = tr.children[4].querySelector("input").value;

        const item = { tipo, exibicao };
        if (tipo === "clima") item.cidade = valor;
        else item.url = valor;
        if (exibicao === "intervalo") {
          item.dataInicio = dataInicio;
          item.dataFim = dataFim;
        }
        config.conteudo.push(item);
      });

      const nomeTV = document.getElementById("tv").value;
      document.getElementById("saida").textContent = `Copie e salve como ${nomeTV}.json em https://github.com/draxizor/TvFood:
\n\n` + JSON.stringify(config, null, 2);
    }

    document.getElementById("btnAdicionar").addEventListener("click", () => adicionarConteudo());
    document.getElementById("btnSalvar").addEventListener("click", () => salvar());
    document.getElementById("btnCarregar").addEventListener("click", () => carregarConfig());

    adicionarConteudo({ tipo: "imagem", url: "media/exemplo.png", exibicao: "sempre" });
  </script>
</body>
</html>
